function load_chatbox(e){var t=!1,n={checkOrigin:0,inPageLinks:!0,autoResize:!0,sizeWidth:!0,resizedCallback:function(n){if(n.width=354,n.height<150&&n.height>60&&e&&"chaticon"==e.visitor_widget_type){var i=0;"yes"==e.enable_online_animation&&(i=30),n.width=82+i,"chaticon"==e.visitor_widget_type&&("medium-size"==e.chat_icon_size?n.width=62+i:"small-size"==e.chat_icon_size&&(n.width=49+i))}if(n.height<190&&n.height>150?t=!0:n.height>200&&(t=!1),e){var o="chat-cmodule-iframe";is_mobile||(o="chat-cmodule-iframe iframe-pull-"+e.window_position),"chaticon"==e.visitor_widget_type?o+=" chat-cmodule-"+e.chat_icon_size:"chatbar"==e.visitor_widget_type&&(n.width=354,o+=" chat-cmodule-widget-bar"),document.getElementById("chatbull-frame").className=o}t&&(n.width=354),document.getElementById("chatbull-frame").style.width=n.width+"px"},initCallback:function(e){},messageCallback:function(e){},closedCallback:function(e){var t=cburl+"index.php?d=visitors&c=chatbox&m=index&token="+access_token;"undefined"!=typeof cbuser&&(t+="&"+buildQueryParam(cbuser)),t+="&"+buildQueryParam(cbwindow),t+="&page_title="+encodeURIComponent(ptitle),t+="&page_url="+encodeURIComponent(purl),window.location=t}};if("undefined"!=typeof require){var i=cburl+"assets/cmodule-chat/js/iframeResizer.min.js";require([i],function(e){e(n)})}else iFrameResize(n)}function initChatbox(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&t(JSON.parse(n.responseText))},n.open("GET",e,!0),n.send(null)}"undefined"==typeof require&&function(e){"use strict";var t,n=0,i=!1,o=!1,r="message".length,a="[iFrameSizer]",s=a.length,c=null,l=e.requestAnimationFrame,d={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},u={},f=null,m={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){w("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};function g(t,n,i){"addEventListener"in e?t.addEventListener(n,i,!1):"attachEvent"in e&&t.attachEvent("on"+n,i)}function h(t,n,i){"removeEventListener"in e?t.removeEventListener(n,i,!1):"detachEvent"in e&&t.detachEvent("on"+n,i)}function p(t){return a+"["+(i="Host page: "+(n=t),e.top!==e.self&&(i=e.parentIFrame&&e.parentIFrame.getId?e.parentIFrame.getId()+": "+n:"Nested host page: "+n),i)+"]";var n,i}function b(e){return u[e]?u[e].log:i}function y(e,t){k("log",e,t,b(e))}function v(e,t){k("info",e,t,b(e))}function w(e,t){k("warn",e,t,!0)}function k(t,n,i,o){!0===o&&"object"==typeof e.console&&console[t](p(n),i)}function x(t){function n(){i("Height"),i("Width"),O(function(){E(H),C(j)},H,"init")}function i(e){var t=Number(u[j]["max"+e]),n=Number(u[j]["min"+e]),i=e.toLowerCase(),o=Number(H[i]);y(j,"Checking "+i+" is in range "+n+"-"+t),o<n&&(o=n,y(j,"Set "+i+" to min value")),o>t&&(o=t,y(j,"Set "+i+" to max value")),H[i]=""+o}function o(e){return P.substr(P.indexOf(":")+r+e)}function l(t,n){S(function(){var i,o;_("Send Page Info","pageInfo:"+(i=document.body.getBoundingClientRect(),o=H.iframe.getBoundingClientRect(),JSON.stringify({iframeHeight:o.height,iframeWidth:o.width,clientHeight:Math.max(document.documentElement.clientHeight,e.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,e.innerWidth||0),offsetTop:parseInt(o.top-i.top,10),offsetLeft:parseInt(o.left-i.left,10),scrollTop:e.pageYOffset,scrollLeft:e.pageXOffset})),t,n)},32)}function d(e){var t=e.getBoundingClientRect();return F(j),{x:Math.floor(Number(t.left)+Number(c.x)),y:Math.floor(Number(t.top)+Number(c.y))}}function f(t){var n=t?d(H.iframe):{x:0,y:0},i={x:Number(H.width)+n.x,y:Number(H.height)+n.y};y(j,"Reposition requested from iFrame (offset x:"+n.x+" y:"+n.y+")"),e.top!==e.self?e.parentIFrame?e.parentIFrame["scrollTo"+(t?"Offset":"")](i.x,i.y):w(j,"Unable to scroll to requested position, window.parentIFrame not found"):(c=i,m(),y(j,"--"))}function m(){!1!==p("scrollCallback",c)?C(j):M()}function p(e,t){return z(j,e,t)}var b,k,x,N,W,P=t.data,H={},j=null;"[iFrameResizerChild]Ready"===P?function(){for(var e in u)_("iFrame requested init",T(e),document.getElementById(e),e)}():a===(""+P).substr(0,s)&&P.substr(s).split(":")[0]in u?(W=P.substr(s).split(":"),H={iframe:u[W[0]].iframe,id:W[0],height:W[1],width:W[2],type:W[3]},j=H.id,(N=H.type in{true:1,false:1,undefined:1})&&y(j,"Ignoring init message from meta parent page"),!N&&(x=!0,u[k=j]||(x=!1,w(H.type+" No settings for "+k+". Message was: "+P)),x)&&(y(j,"Received: "+P),b=!0,null===H.iframe&&(w(j,"IFrame ("+H.id+") not found"),b=!1),b&&function(){var e,n=t.origin,i=u[j].checkOrigin;if(i&&""+n!="null"&&!(i.constructor===Array?function(){var e=0,t=!1;for(y(j,"Checking connection is from allowed list of origins: "+i);e<i.length;e++)if(i[e]===n){t=!0;break}return t}():(e=u[j].remoteHost,y(j,"Checking connection is from: "+e),n===e)))throw new Error("Unexpected message received from: "+n+" for "+H.iframe.id+". Message was: "+t.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}()&&function(){switch(u[j].firstRun&&(u[j].firstRun=!1),H.type){case"close":I(H.iframe);break;case"message":b=o(6),y(j,"MessageCallback passed: {iframe: "+H.iframe.id+", message: "+b+"}"),p("messageCallback",{iframe:H.iframe,message:JSON.parse(b)}),y(j,"--");break;case"scrollTo":f(!1);break;case"scrollToOffset":f(!0);break;case"pageInfo":l(u[j].iframe,j),function(){function t(t,o){function r(){u[i]?l(u[i].iframe,i):n()}["scroll","resize"].forEach(function(n){y(i,t+n+" listener for sendPageInfo"),o(e,n,r)})}function n(){t("Remove ",h)}var i=j;t("Add ",g),u[i].stopPageInfo=n}();break;case"pageInfoStop":u[j]&&u[j].stopPageInfo&&(u[j].stopPageInfo(),delete u[j].stopPageInfo);break;case"inPageLink":t=o(9),r=t.split("#")[1]||"",a=decodeURIComponent(r),(s=document.getElementById(a)||document.getElementsByName(a)[0])?(i=d(s),y(j,"Moving to in page link (#"+r+") at x: "+i.x+" y: "+i.y),c={x:i.x,y:i.y},m(),y(j,"--")):e.top!==e.self?e.parentIFrame?e.parentIFrame.moveToAnchor(r):y(j,"In page link #"+r+" not found and window.parentIFrame not found"):y(j,"In page link #"+r+" not found");break;case"reset":R(H);break;case"init":n(),p("initCallback",H.iframe),p("resizedCallback",H);break;default:n(),p("resizedCallback",H)}var t,i,r,a,s,b}())):v(j,"Ignored: "+P)}function z(e,t,n){var i=null,o=null;if(u[e]){if("function"!=typeof(i=u[e][t]))throw new TypeError(t+" on iFrame["+e+"] is not a function");o=i(n)}return o}function I(e){var t=e.id;y(t,"Removing iFrame: "+t),e.parentNode.removeChild(e),z(t,"closedCallback",t),y(t,"--"),delete u[t]}function F(t){null===c&&y(t,"Get page position: "+(c={x:void 0!==e.pageXOffset?e.pageXOffset:document.documentElement.scrollLeft,y:void 0!==e.pageYOffset?e.pageYOffset:document.documentElement.scrollTop}).x+","+c.y)}function C(t){null!==c&&(e.scrollTo(c.x,c.y),y(t,"Set page position: "+c.x+","+c.y),M())}function M(){c=null}function R(e){y(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),F(e.id),O(function(){E(e),_("reset","reset",e.iframe,e.id)},e,"reset")}function E(t){function n(n){o||"0"!==t[n]||(o=!0,y(r,"Hidden iFrame detected, creating visibility listener"),function(){function t(){function e(e){function t(t){return"0px"===u[e].iframe.style[t]}null!==u[e].iframe.offsetParent&&(t("height")||t("width"))&&_("Visibility change","resize",u[e].iframe,e)}for(var t in u)e(t)}function n(e){y("window","Mutation observed: "+e[0].target+" "+e[0].type),S(t,16)}var i=e.MutationObserver||e.WebKitMutationObserver;i&&(o=document.querySelector("body"),new i(n).observe(o,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0}));var o}())}function i(e){var i;i=e,t.iframe.style[i]=t[i]+"px",y(t.id,"IFrame ("+r+") "+i+" set to "+t[i]+"px"),n(e)}var r=t.iframe.id;u[r]&&(u[r].sizeHeight&&i("height"),u[r].sizeWidth&&i("width"))}function O(e,t,n){n!==t.type&&l?(y(t.id,"Requesting animation frame"),l(e)):e()}function _(e,t,n,i){var o;i=i||n.id,u[i]&&(n&&"contentWindow"in n&&null!==n.contentWindow?(o=u[i].targetOrigin,y(i,"["+e+"] Sending msg to iframe["+i+"] ("+t+") targetOrigin: "+o),n.contentWindow.postMessage(a+t,o)):(v(i,"["+e+"] IFrame("+i+") not found"),u[i]&&delete u[i]))}function T(e){return e+":"+u[e].bodyMarginV1+":"+u[e].sizeWidth+":"+u[e].log+":"+u[e].interval+":"+u[e].enablePublicMethods+":"+u[e].autoResize+":"+u[e].bodyMargin+":"+u[e].heightCalculationMethod+":"+u[e].bodyBackground+":"+u[e].bodyPadding+":"+u[e].tolerance+":"+u[e].inPageLinks+":"+u[e].resizeFrom+":"+u[e].widthCalculationMethod}function N(e,t){var o,r,a,s,c,l=(o=e.id,o,""===o&&(e.id=(r=t&&t.id||m.id+n++,null!==document.getElementById(r)&&(r+=n++),o=r),i=(t||{}).log,o,y(o,"Added missing iframe ID: "+o+" ("+e.src+")")),o);l in u&&"iFrameResizer"in e?w(l,"Ignored iFrame, already setup."):(s=(s=t)||{},u[l]={firstRun:!0,iframe:e,remoteHost:e.src.split("/").slice(0,3).join("/")},function(e){if("object"!=typeof e)throw new TypeError("Options is not an object")}(s),function(e){for(var t in m)m.hasOwnProperty(t)&&(u[l][t]=e.hasOwnProperty(t)?e[t]:m[t])}(s),u[l].targetOrigin=!0===u[l].checkOrigin?""===(c=u[l].remoteHost)||"file://"===c?"*":c:"*",y(l,"IFrame scrolling "+(u[l].scrolling?"enabled":"disabled")+" for "+l),e.style.overflow=!1===u[l].scrolling?"hidden":"auto",e.scrolling=!1===u[l].scrolling?"no":"yes",function(){function t(t){1/0!==u[l][t]&&0!==u[l][t]&&(e.style[t]=u[l][t]+"px",y(l,"Set "+t+" = "+u[l][t]+"px"))}function n(e){if(u[l]["min"+e]>u[l]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}n("Height"),n("Width"),t("maxHeight"),t("minHeight"),t("maxWidth"),t("minWidth")}(),"number"!=typeof u[l].bodyMargin&&"0"!==u[l].bodyMargin||(u[l].bodyMarginV1=u[l].bodyMargin,u[l].bodyMargin=u[l].bodyMargin+"px"),a=T(l),g(e,"load",function(){var t,n;_("iFrame.onload",a,e),t=u[l].firstRun,n=u[l].heightCalculationMethod in d,!t&&n&&R({iframe:e,height:0,width:0,type:"init"})}),_("init",a,e),Function.prototype.bind&&(u[l].iframe.iFrameResizer={close:I.bind(null,u[l].iframe),resize:_.bind(null,"Window resize","resize",u[l].iframe),moveToAnchor:function(e){_("Move to anchor","moveToAnchor:"+e,u[l].iframe,l)},sendMessage:function(e){_("Send Message","message:"+(e=JSON.stringify(e)),u[l].iframe,l)}}))}function S(e,t){null===f&&(f=setTimeout(function(){f=null,e()},t))}function W(e){y("window","Trigger event: "+e),S(function(){H("Window "+e,"resize")},16)}function P(){"hidden"!==document.visibilityState&&(y("document","Trigger event: Visiblity change"),S(function(){H("Tab Visable","resize")},16))}function H(e,t){for(var n in u)"parent"===u[i=n].resizeFrom&&u[i].autoResize&&!u[i].firstRun&&_(e,t,document.getElementById(n),n);var i}function j(){function t(e,t){t&&(!function(){if(!t.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==t.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+t.tagName+">")}(),N(t,e),n.push(t))}var n;return function(){var t,n=["moz","webkit","o","ms"];for(t=0;t<n.length&&!l;t+=1)l=e[n[t]+"RequestAnimationFrame"];l||y("setup","RequestAnimationFrame not supported")}(),g(e,"message",x),g(e,"resize",function(){W("resize")}),g(document,"visibilitychange",P),g(document,"-webkit-visibilitychange",P),g(e,"focusin",function(){W("focus")}),g(e,"focus",function(){W("focus")}),function(e,i){switch(n=[],typeof i){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(i||"iframe"),t.bind(void 0,e));break;case"object":t(e,i);break;default:throw new TypeError("Unexpected data type ("+typeof i+")")}return n}}e.jQuery&&((t=jQuery).fn?t.fn.iFrameResize=function(e){return this.filter("iframe").each(function(t,n){N(n,e)}).end()}:v("","Unable to bind to jQuery, it is not fully loaded.")),"function"==typeof define&&define.amd?define([],j):"object"==typeof module&&"object"==typeof module.exports?module.exports=j():e.iFrameResize=e.iFrameResize||j()}(window||{}),initChatbox(cburl+"index.php?d=visitors&c=chatbox&m=settings_json&token="+access_token,load_chatbox);